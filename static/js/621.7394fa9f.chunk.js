"use strict";(self.webpackChunkfitness_ai=self.webpackChunkfitness_ai||[]).push([[621],{82:(e,t,r)=>{r.d(t,{$H:()=>c,FS:()=>T,SK:()=>o,Tj:()=>E,gM:()=>a,hp:()=>i,m:()=>s});const n=(e,t,r)=>({x:e.x*t,y:e.y*r}),o=(e,t,r,o)=>{const l={nose:0,left:{shoulder:11,elbow:13,wrist:15,hip:23,knee:25,ankle:27,foot:31},right:{shoulder:12,elbow:14,wrist:16,hip:24,knee:26,ankle:28,foot:32}};if("nose"===t)return n(e[l.nose],r,o);if("left"===t||"right"===t){const c=l[t];return{shoulder:n(e[c.shoulder],r,o),elbow:n(e[c.elbow],r,o),wrist:n(e[c.wrist],r,o),hip:n(e[c.hip],r,o),knee:n(e[c.knee],r,o),ankle:n(e[c.ankle],r,o),foot:n(e[c.foot],r,o)}}throw new Error("Feature must be 'nose', 'left', or 'right'.")},l=e=>Math.sqrt(e.x*e.x+e.y*e.y),c=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0};const n={x:e.x-r.x,y:e.y-r.y},o={x:t.x-r.x,y:t.y-r.y},c=((s=n).x*(i=o).x+s.y*i.y)/(l(n)*l(o));var s,i;const a=Math.acos(Math.max(Math.min(c,1),-1));return Math.round(a*(180/Math.PI))},s=function(e,t,r,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{boxWidth:l=8,textColor:c="rgb(0, 255, 0)",backgroundColor:s="rgb(0, 0, 0)",fontSize:i="16px",fontFamily:a="Arial",paddingX:T=20,paddingY:E=10}=o;e.font=`${i} ${a}`;const u=e.measureText(t).width,_=parseInt(i,10);((e,t,r,n,o,l,c)=>{e.fillStyle=c,e.beginPath(),e.moveTo(t+l,r),e.arcTo(t+n,r,t+n,r+o,l),e.arcTo(t+n,r+o,t,r+o,l),e.arcTo(t,r+o,t,r,l),e.arcTo(t,r,t+n,r,l),e.closePath(),e.fill()})(e,r-T,n-_-E,u+2*T,_+2*E,l,s),e.fillStyle=c,e.fillText(t,r,n+E/2)},i=(e,t,r,n)=>{e.beginPath(),e.arc(t.x,t.y,r,0,2*Math.PI),e.fillStyle=n,e.fill()},a=(e,t,r,n,o)=>{e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(r.x,r.y),e.strokeStyle=n,e.lineWidth=o,e.stroke()},T=(e,t,r,n)=>{const o=Math.sqrt((r.x-t.x)**2+(r.y-t.y)**2),l=Math.floor(o/5);for(let c=0;c<l;c++){const o=t.x+(r.x-t.x)/l*c,s=t.y+(r.y-t.y)/l*c;e.beginPath(),e.arc(o,s,1,0,2*Math.PI),e.fillStyle=n,e.fill()}},E={blue:"rgb(0,127,255)",red:"rgb(255,50,50)",green:"rgb(0,255,127)",light_green:"rgb(100,233,127)",yellow:"rgb(255,255,0)",magenta:"rgb(255,0,255)",white:"rgb(255,255,255)",cyan:"rgb(0,255,255)",light_blue:"rgb(102,204,255)"}},155:(e,t,r)=>{r.d(t,{E2:()=>c,Jx:()=>s,PY:()=>o,QM:()=>T,_w:()=>l,af:()=>i,dT:()=>a,f_:()=>n,jK:()=>E});const n={ANGLE_ELBOW:{NORMAL:[0,20],TRANS:[21,70],PASS:[71,140]},ELBOW_THRESH:[10,140],INACTIVE_THRESH:10,CNT_FRAME_THRESH:30},o={ANGLE_HIP_KNEE_VERT:{NORMAL:[0,32],TRANS:[35,65],PASS:[70,95]},HIP_THRESH:[10,50],ANKLE_THRESH:45,KNEE_THRESH:[50,70,95],OFFSET_THRESH:35,INACTIVE_THRESH:15,CNT_FRAME_THRESH:50},l={ANGLE_HIP_KNEE_VERT:{NORMAL:[0,32],TRANS:[35,65],PASS:[80,95]},HIP_THRESH:[15,50],ANKLE_THRESH:30,KNEE_THRESH:[50,80,95],OFFSET_THRESH:35,INACTIVE_THRESH:15,CNT_FRAME_THRESH:50},c={ANGLE_SHOULDER_HIP_VERT:{NORMAL:[30,60],TRANS:[61,75],PASS:[76,90]},HIP_THRESH:[0,10],NECK_THRESH:[10,30],INACTIVE_THRESH:10,CNT_FRAME_THRESH:50},s={ANGLE_SHOULDER_HIP_VERT:{NORMAL:[35,55],TRANS:[56,70],PASS:[71,85]},HIP_THRESH:[0,5],NECK_THRESH:[5,20],INACTIVE_THRESH:8,CNT_FRAME_THRESH:50},i={ANGLE_ELBOW:{NORMAL:[0,5],TRANS:[6,15],PASS:[16,25]},OFFSET_THRESH:20,INACTIVE_THRESH:10,CNT_FRAME_THRESH:50},a={ANGLE_ELBOW:{NORMAL:[25,30],TRANS:[31,89],PASS:[90,120]},OFFSET_THRESH:20,INACTIVE_THRESH:10,CNT_FRAME_THRESH:50},T={ANGLE_SHOULDER:{NORMAL:[0,15],TRANS:[16,45],PASS:[46,90]},OFFSET_THRESH:20,INACTIVE_THRESH:10,CNT_FRAME_THRESH:50},E={ANGLE_SHOULDER:{NORMAL:[0,10],TRANS:[11,45],PASS:[46,90]},OFFSET_THRESH:20,INACTIVE_THRESH:10,CNT_FRAME_THRESH:50}},621:(e,t,r)=>{r.r(t),r.d(t,{default:()=>h});var n=r(43),o=r(29),l=r.n(o),c=r(879),s=r(943),i=r(155),a=r(82),T=r(16),E=r(768),u=r(115),_=(r(342),r(579));const h=function(){const e=(0,n.useRef)(null),t=(0,n.useRef)(null),r=(0,n.useRef)(null),o=(0,n.useRef)(null),{user:h}=(0,T.A)(),[R,S]=(0,n.useState)(!0),[d,N]=(0,n.useState)(0),[A,I]=(0,n.useState)(0),[x,H]=(0,n.useState)(!1),g=(0,n.useRef)(!1),[C,b]=(0,n.useState)(i.PY),m=(0,n.useRef)({state_seq:[],start_inactive_time:Date.now(),start_inactive_time_front:Date.now(),INACTIVE_TIME:0,INACTIVE_TIME_FRONT:0,DISPLAY_TEXT:Array(4).fill(!1),COUNT_FRAMES:Array(4).fill(0),LOWER_HIPS:!1,INCORRECT_POSTURE:!1,prev_state:null,curr_state:null,SQUAT_COUNT:0,IMPROPER_SQUAT:0}),f={0:{text:"BEND BACKWARDS",position:215,color:"rgb(0,153,255)"},1:{text:"BEND FORWARD",position:215,color:"rgb(0,153,255)"},2:{text:"KNEE FALLING OVER TOE",position:170,color:"rgb(255,80,80)"},3:{text:"SQUAT TOO DEEP",position:125,color:"rgb(255,80,80)"}},p=()=>{e.current&&e.current.video&&(r.current=new s.Camera(e.current.video,{onFrame:async()=>{e.current&&e.current.video&&o.current&&await o.current.send({image:e.current.video})},width:640,height:480}),r.current.start())},O=(0,n.useCallback)((r=>{if(e.current&&t.current){const n=t.current,o=n.getContext("2d");n.width=e.current.video.videoWidth,n.height=e.current.video.videoHeight;const l=n.width,c=n.height;o.drawImage(e.current.video,0,0,n.width,n.height);let s=!1,i=Date.now();if(r.poseLandmarks){const e=(0,a.SK)(r.poseLandmarks,"nose",l,c),t=(0,a.SK)(r.poseLandmarks,"left",l,c),T=(0,a.SK)(r.poseLandmarks,"right",l,c),E=(0,a.$H)(t.shoulder,T.shoulder,e);if(E>C.OFFSET_THRESH)s=!1,i=Date.now(),m.current.INACTIVE_TIME_FRONT+=i-m.current.start_inactive_time_front,m.current.start_inactive_time_front=i,m.current.INACTIVE_TIME_FRONT>=C.INACTIVE_THRESH&&(s=!0),(0,a.hp)(o,e,7,a.Tj.white),(0,a.hp)(o,t.shoulder,7,a.Tj.yellow),(0,a.hp)(o,T.shoulder,7,a.Tj.magenta),g.current&&(o.translate(n.width,0),o.scale(-1,1),o.translate(-n.width,0)),s&&(m.current.INACTIVE_TIME_FRONT=0,m.current.start_inactive_time_front=Date.now()),(0,a.m)(o,`CORRECT: ${m.current.SQUAT_COUNT}`,.68*l,30,{textColor:"rgb(255, 255, 230)",backgroundColor:"rgb(18, 185, 0)",fontSize:"14px"}),(0,a.m)(o,`INCORRECT: ${m.current.IMPROPER_SQUAT}`,.68*l,80,{textColor:"rgb(255, 255, 230)",backgroundColor:"rgb(221, 0, 0)",fontSize:"14px"}),(0,a.m)(o,"CAMERA NOT ALIGNED PROPERLY!!!",30,c-60,{textColor:"rgb(255, 255, 230)",backgroundColor:"rgb(255, 153, 0)",fontSize:"14px"}),(0,a.m)(o,`OFFSET ANGLE: ${E.toFixed(2)}`,30,c-30,{textColor:"rgb(255, 255, 230)",backgroundColor:"rgb(255, 153, 0)",fontSize:"14px"}),m.current.start_inactive_time=Date.now(),m.current.INACTIVE_TIME=0,m.current.prev_state=null,m.current.curr_state=null;else{m.current.INACTIVE_TIME_FRONT=0,m.current.start_inactive_time_front=Date.now();let e=null,r=0;Math.abs(t.foot.y-t.shoulder.y)>Math.abs(T.foot.y-T.shoulder.y)?(e=t,r=-1):(e=T,r=1);const n=(0,a.$H)(e.shoulder,{x:e.hip.x,y:0},e.hip);(0,a.hp)(o,e.hip,15,a.Tj.white);let c={x:e.hip.x,y:e.hip.y-80},E={x:e.hip.x,y:e.hip.y+20};(0,a.FS)(o,c,E,a.Tj.blue);const u=(0,a.$H)(e.hip,{x:e.knee.x,y:0},e.knee);(0,a.hp)(o,e.knee,10,a.Tj.white),c={x:e.knee.x,y:e.knee.y-50},E={x:e.knee.x,y:e.knee.y+20},(0,a.FS)(o,c,E,a.Tj.blue);const _=(0,a.$H)(e.knee,{x:e.ankle.x,y:0},e.ankle);(0,a.hp)(o,e.ankle,15,a.Tj.white);const h={x:e.ankle.x,y:e.ankle.y-50},R={x:e.ankle.x,y:e.ankle.y+20};(0,a.FS)(o,h,R,a.Tj.blue),(0,a.gM)(o,e.shoulder,e.elbow,a.Tj.light_blue,4),(0,a.gM)(o,e.wrist,e.elbow,a.Tj.light_blue,4),(0,a.gM)(o,e.shoulder,e.hip,a.Tj.light_blue,4),(0,a.gM)(o,e.knee,e.hip,a.Tj.light_blue,4),(0,a.gM)(o,e.ankle,e.knee,a.Tj.light_blue,4),(0,a.gM)(o,e.ankle,e.foot,a.Tj.light_blue,4),(0,a.hp)(o,e.shoulder,7,a.Tj.yellow),(0,a.hp)(o,e.elbow,7,a.Tj.yellow),(0,a.hp)(o,e.wrist,7,a.Tj.yellow),(0,a.hp)(o,e.hip,7,a.Tj.yellow),(0,a.hp)(o,e.knee,7,a.Tj.yellow),(0,a.hp)(o,e.ankle,7,a.Tj.yellow),(0,a.hp)(o,e.foot,7,a.Tj.yellow);const S=(e=>{let t=null;return e>=C.ANGLE_HIP_KNEE_VERT.NORMAL[0]&&e<=C.ANGLE_HIP_KNEE_VERT.NORMAL[1]?t="s1":e>=C.ANGLE_HIP_KNEE_VERT.TRANS[0]&&e<=C.ANGLE_HIP_KNEE_VERT.TRANS[1]?t="s2":e>=C.ANGLE_HIP_KNEE_VERT.PASS[0]&&e<=C.ANGLE_HIP_KNEE_VERT.PASS[1]&&(t="s3"),t})(u);m.current.curr_state=S,(e=>{let t=[...m.current.state_seq];"s2"===e?(!t.includes("s3")&&0===t.filter((e=>"s2"===e)).length||t.includes("s3")&&1===t.filter((e=>"s2"===e)).length)&&t.push(e):"s3"===e&&!t.includes("s3")&&t.includes("s2")&&t.push(e),m.current.state_seq=t})(S);const{state_seq:d,INCORRECT_POSTURE:A}=m.current;if("s1"===S)3!==d.length||A?(d.includes("s2")&&1===d.length||A)&&(m.current.IMPROPER_SQUAT+=1,I(m.current.IMPROPER_SQUAT)):(m.current.SQUAT_COUNT+=1,N(m.current.SQUAT_COUNT)),m.current.state_seq=[],m.current.INCORRECT_POSTURE=!1;else{const e=m.current;n>C.HIP_THRESH[1]?e.DISPLAY_TEXT[0]=!0:n<C.HIP_THRESH[0]&&1===e.state_seq.filter((e=>"s2"===e)).length&&(e.DISPLAY_TEXT[1]=!0),C.KNEE_THRESH[0]<u&&u<C.KNEE_THRESH[1]&&1===e.state_seq.filter((e=>"s2"===e)).length?e.LOWER_HIPS=!0:u>C.KNEE_THRESH[2]&&(e.DISPLAY_TEXT[3]=!0,e.INCORRECT_POSTURE=!0),_>C.ANKLE_THRESH&&(e.DISPLAY_TEXT[2]=!0,e.INCORRECT_POSTURE=!0)}s=!1,m.current.curr_state===m.current.prev_state?(i=Date.now(),m.current.INACTIVE_TIME+=i-m.current.start_inactive_time,m.current.start_inactive_time=i,m.INACTIVE_TIME>=C.INACTIVE_THRESH&&(s=!0)):(m.current.start_inactive_time=Date.now(),m.current.INACTIVE_TIME=0);const x=g.current?l-e.hip.x+10:e.hip.x+10,H=g.current?l-e.knee.x+15:e.knee.x+15,b=g.current?l-e.ankle.x+10:e.ankle.x+10;(m.current.state_seq.includes("s3")||"s1"===S)&&(m.current.LOWER_HIPS=!1),m.current.DISPLAY_TEXT.forEach(((e,t)=>{e&&(m.current.COUNT_FRAMES[t]+=1)})),(e=>{const t=m.current;t.LOWER_HIPS&&(0,a.m)(e,"LOWER YOUR HIPS",30,80,{textColor:"black",backgroundColor:"yellow",fontSize:"16px"}),t.DISPLAY_TEXT.forEach(((t,r)=>{if(t){const t=f[r];t&&(0,a.m)(e,t.text,30,t.position,{textColor:"black",backgroundColor:"yellow",fontSize:"16px"})}}))})(o),s&&(m.current.start_inactive_time=Date.now(),m.current.INACTIVE_TIME=0),(0,a.m)(o,`Hip Angle: ${n.toFixed(2)}`,x,e.hip[1],{textColor:a.Tj.light_green,fontSize:"16px"}),(0,a.m)(o,`Knee Angle: ${u.toFixed(2)}`,H,e.knee[1]+10,{textColor:a.Tj.light_green,fontSize:"16px"}),(0,a.m)(o,`Ankle Angle: ${_.toFixed(2)}`,b,e.ankle[1],{textColor:a.Tj.light_green,fontSize:"16px"}),(0,a.m)(o,`CORRECT: ${m.current.SQUAT_COUNT}`,.68*l,30,{textColor:"rgb(255, 255, 230)",backgroundColor:"rgb(18, 185, 0)",fontSize:"14px"}),(0,a.m)(o,`INCORRECT: ${m.current.IMPROPER_SQUAT}`,.68*l,80,{textColor:"rgb(255, 255, 230)",backgroundColor:"rgb(221, 0, 0)",fontSize:"14px"}),m.current.DISPLAY_TEXT.forEach(((e,t)=>{m.current.COUNT_FRAMES[t]>C.CNT_FRAME_THRESH&&(m.current.DISPLAY_TEXT[t]=!1,m.current.COUNT_FRAMES[t]=0)})),m.current.prev_state=S}}else{g.current&&(o.translate(n.width,0),o.scale(-1,1),o.drawImage(e.current.video,0,0,n.width,n.height),o.setTransform(1,0,0,1,0,0));const t=Date.now();m.current.INACTIVE_TIME+=t-m.current.start_inactive_time;let r=!1;m.current.INACTIVE_TIME>=C.INACTIVE_THRESH&&(r=!0),m.current.start_inactive_time=t,(0,a.m)(o,`CORRECT: ${m.current.SQUAT_COUNT}`,.68*l,30,{textColor:"rgb(255, 255, 230)",backgroundColor:"rgb(18, 185, 0)",fontSize:"14px"}),(0,a.m)(o,`INCORRECT: ${m.current.IMPROPER_SQUAT}`,.68*l,80,{textColor:"rgb(255, 255, 230)",backgroundColor:"rgb(221, 0, 0)",fontSize:"14px"}),r&&(m.current.start_inactive_time=Date.now(),m.current.INACTIVE_TIME=0),m.current.prev_state=null,m.current.curr_state=null,m.current.INACTIVE_TIME_FRONT=0,m.current.INCORRECT_POSTURE=!1,m.current.DISPLAY_TEXT=Array(5).fill(!1),m.current.start_inactive_time_front=Date.now()}}}),[e,t]);return(0,n.useEffect)((()=>{const t=new c.Pose({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${e}`});return t.setOptions({modelComplexity:1,smoothLandmarks:!0,enableSegmentation:!1,smoothSegmentation:!1,minDetectionConfidence:.5,minTrackingConfidence:.5}),o.current=t,t.onResults(O),()=>{if(o.current&&(o.current.close(),o.current=null),r.current&&(r.current.stop(),r.current=null),e.current&&e.current.video&&e.current.video.srcObject){e.current.video.srcObject.getTracks().forEach((e=>e.stop())),e.current.video.srcObject=null}}}),[O]),(0,_.jsx)(_.Fragment,{children:(0,_.jsx)("div",{className:"card",children:(0,_.jsxs)("div",{className:"card-body",children:[(0,_.jsxs)("div",{className:"row",children:[(0,_.jsx)("div",{className:"col-md-6 col-sm-12 text-center mb-3",children:(0,_.jsx)("p",{children:"Video Alan\u0131"})}),(0,_.jsx)("div",{className:"col-md-6 col-sm-12 text-center mb-3",children:(0,_.jsx)("p",{children:"Bilgilendirme Alan\u0131"})})]}),(0,_.jsxs)("div",{className:"row",children:[(0,_.jsxs)("div",{className:"col-md-6 col-sm-12 mb-3",children:[(0,_.jsx)(l(),{ref:e,style:{display:"none"}}),(0,_.jsx)("canvas",{ref:t,className:"h-full w-full object-contain",style:{maxWidth:"100%",maxHeight:"100%",position:"relative",left:0,top:0}})]}),(0,_.jsxs)("div",{className:"col-md-6 col-sm-12",children:[(0,_.jsxs)("select",{className:"form-select","aria-label":"Default select example",onChange:e=>{const t="beginner"===e.target.value;S(t);const r=t?i.PY:i._w;b(r),console.log("Current Thresholds:",r)},value:R?"beginner":"pro",children:[(0,_.jsx)("option",{className:"dropdown-item",value:"beginner",children:"Beginner Mode"}),(0,_.jsx)("option",{className:"dropdown-item",value:"pro",children:"Pro Mode"})]}),(0,_.jsxs)("table",{className:"table mt-3",children:[(0,_.jsx)("thead",{children:(0,_.jsxs)("tr",{children:[(0,_.jsx)("th",{scope:"col",children:"Metric"}),(0,_.jsx)("th",{scope:"col",children:"Value"})]})}),(0,_.jsxs)("tbody",{children:[(0,_.jsxs)("tr",{children:[(0,_.jsx)("td",{children:"Correct"}),(0,_.jsx)("td",{children:d})]}),(0,_.jsxs)("tr",{children:[(0,_.jsx)("td",{children:"Incorrect"}),(0,_.jsx)("td",{children:A})]})]})]}),(0,_.jsx)("button",{className:"btn btn-success mt-3",onClick:()=>{H(!0),p()},children:"Start Sport"}),(0,_.jsx)("button",{className:"btn btn-danger mt-3 ms-2",onClick:()=>{if(0===d&&0===A||(async()=>{const e=null===h||void 0===h?void 0:h.id,t=(new Date).toISOString();try{const r=await(0,E.R7)({userId:e,exerciseId:3,correct:d,incorrect:A,createdDate:t});u.oR.success(`Kay\u0131t i\u015flemi ba\u015far\u0131yla tamamland\u0131! ${r}`)}catch(r){u.oR.error(`Sonu\xe7lar g\xf6nderilirken bir hata olu\u015ftu: ${r.message}`)}})(),N(0),I(0),m.current.LATERAL_RAISE_COUNT=0,m.current.IMPROPER_RAISE=0,o.current&&(o.current.close(),o.current=null),r.current&&(r.current.stop(),r.current=null),e.current&&e.current.video&&e.current.video.srcObject){e.current.video.srcObject.getTracks().forEach((e=>e.stop())),e.current.video.srcObject=null}if(H(!1),t.current){const e=t.current,r=e.getContext("2d");r.clearRect(0,0,e.width,e.height),r.fillStyle="black",r.fillRect(0,0,e.width,e.height)}},children:"Finish Sport"})]})]})]})})})}}}]);
//# sourceMappingURL=621.7394fa9f.chunk.js.map