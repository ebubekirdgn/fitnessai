"use strict";(self.webpackChunkfitness_ai=self.webpackChunkfitness_ai||[]).push([[28],{28:(e,t,r)=>{r.r(t),r.d(t,{default:()=>d});var n=r(43),o=r(29),s=r.n(o),l=r(879),c=r(943),i=r(155),a=r(82),T=r(768),E=r(16),u=r(115),_=(r(342),r(662)),R=r(579);const d=function(){const e=(0,n.useRef)(null),t=(0,n.useRef)(null),r=(0,n.useRef)(null),o=(0,n.useRef)(null),d=(0,_.Zp)(),{user:S}=(0,E.A)(),[h,C]=(0,n.useState)(!0),[N,I]=(0,n.useState)(0),[x,A]=(0,n.useState)(0),[b,g]=(0,n.useState)(!1),O=(0,n.useRef)(!1),[H,m]=(0,n.useState)(i.af),f=(0,n.useRef)({state_seq:[],start_inactive_time:Date.now(),start_inactive_time_front:Date.now(),INACTIVE_TIME:0,INACTIVE_TIME_FRONT:0,DISPLAY_TEXT:Array(4).fill(!1),COUNT_FRAMES:Array(4).fill(0),INCORRECT_POSTURE:!1,prev_state:null,curr_state:null,TRICEPS_COUNT:0,INCORRECT_TRICEPS:0}),w=()=>{e.current&&e.current.video&&(r.current=new c.Camera(e.current.video,{onFrame:async()=>{e.current&&e.current.video&&o.current&&await o.current.send({image:e.current.video})},width:640,height:480}),r.current.start())},p={0:{text:"KEEP ELBOWS CLOSE TO HEAD",position:215,color:"rgb(255,153,0)"},1:{text:"FULLY EXTEND YOUR ARMS",position:170,color:"rgb(0,153,255)"},2:{text:"DO NOT FLARE ELBOWS",position:125,color:"rgb(255,80,80)"},3:{text:"RETURN TO START POSITION",position:80,color:"rgb(255,0,0)"}},y=(0,n.useCallback)((r=>{if(e.current&&t.current){const o=t.current,s=o.getContext("2d");o.width=e.current.video.videoWidth,o.height=e.current.video.videoHeight;const l=o.width,c=o.height;s.drawImage(e.current.video,0,0,o.width,o.height);let i=!1,T=Date.now();if(r.poseLandmarks){const e=(0,a.SK)(r.poseLandmarks,"nose",l,c),t=(0,a.SK)(r.poseLandmarks,"left",o.width,o.height),E=(0,a.SK)(r.poseLandmarks,"right",o.width,o.height),u=(0,a.$H)(t.shoulder,E.shoulder,e);if(u>H.OFFSET_THRESH)i=!1,T=Date.now(),f.current.INACTIVE_TIME_FRONT+=T-f.current.start_inactive_time_front,f.current.start_inactive_time_front=T,f.current.INACTIVE_TIME_FRONT>=H.INACTIVE_THRESH&&(i=!0),(0,a.hp)(s,e,7,a.Tj.white),(0,a.hp)(s,t.shoulder,7,a.Tj.yellow),(0,a.hp)(s,E.shoulder,7,a.Tj.magenta),O.current&&(s.translate(o.width,0),s.scale(-1,1),s.translate(-o.width,0)),i&&(f.current.INACTIVE_TIME_FRONT=0,f.current.start_inactive_time_front=Date.now()),(0,a.m)(s,`CORRECT: ${f.current.TRICEPS_COUNT}`,.68*l,30,{textColor:"rgb(255, 255, 230)",backgroundColor:"rgb(18, 185, 0)",fontSize:"14px"}),(0,a.m)(s,`INCORRECT: ${f.current.INCORRECT_TRICEPS}`,.68*l,80,{textColor:"rgb(255, 255, 230)",backgroundColor:"rgb(221, 0, 0)",fontSize:"14px"}),(0,a.m)(s,"CAMERA NOT ALIGNED PROPERLY!!!",30,c-60,{textColor:"rgb(255, 255, 230)",backgroundColor:"rgb(255, 153, 0)",fontSize:"14px"}),(0,a.m)(s,`OFFSET ANGLE: ${u.toFixed(2)}`,30,c-30,{textColor:"rgb(255, 255, 230)",backgroundColor:"rgb(255, 153, 0)",fontSize:"14px"}),f.current.start_inactive_time=Date.now(),f.current.INACTIVE_TIME=0,f.current.prev_state=null,f.current.curr_state=null;else{f.current.INACTIVE_TIME_FRONT=0,f.current.start_inactive_time_front=Date.now();let e=null,r=0;Math.abs(t.foot.y-t.shoulder.y)>Math.abs(E.foot.y-E.shoulder.y)?(e=t,r=-1):(e=E,r=1);const o=(0,a.$H)(e.hip,{x:e.shoulder.x,y:0},e.shoulder);(0,a.hp)(s,e.shoulder,15,a.Tj.white);let c={x:e.shoulder.x,y:e.shoulder.y-80},u={x:e.shoulder.x,y:e.shoulder.y+20};(0,a.FS)(s,c,u,a.Tj.blue);const _=(0,a.$H)(e.shoulder,{x:e.elbow.x,y:0},e.elbow);(0,a.hp)(s,e.elbow,10,a.Tj.white),c={x:e.elbow.x,y:e.elbow.y-50},u={x:e.elbow.x,y:e.elbow.y+20},(0,a.FS)(s,c,u,a.Tj.blue);const R=(0,a.$H)(e.elbow,{x:e.wrist.x,y:0},e.wrist);(0,a.hp)(s,e.wrist,15,a.Tj.white),c={x:e.wrist.x,y:e.wrist.y-50},u={x:e.wrist.x,y:e.wrist.y+20},(0,a.FS)(s,c,u,a.Tj.blue),(0,a.gM)(s,e.shoulder,e.elbow,a.Tj.light_blue,4),(0,a.gM)(s,e.elbow,e.wrist,a.Tj.light_blue,4),(0,a.hp)(s,e.shoulder,7,a.Tj.yellow),(0,a.hp)(s,e.elbow,7,a.Tj.yellow),(0,a.hp)(s,e.wrist,7,a.Tj.yellow);const d=(n=_)>=H.ANGLE_ELBOW.NORMAL[0]&&n<=H.ANGLE_ELBOW.NORMAL[1]?"s1":n>=H.ANGLE_ELBOW.TRANS[0]&&n<=H.ANGLE_ELBOW.TRANS[1]?"s2":n>=H.ANGLE_ELBOW.PASS[0]&&n<=H.ANGLE_ELBOW.PASS[1]?"s3":null;f.current.curr_state=d,(e=>{let t=[...f.current.state_seq];"s2"===e?(!t.includes("s3")&&0===t.filter((e=>"s2"===e)).length||t.includes("s3")&&1===t.filter((e=>"s2"===e)).length)&&t.push(e):"s3"===e&&!t.includes("s3")&&t.includes("s2")&&t.push(e),f.current.state_seq=t})(d);const{state_seq:S,INCORRECT_POSTURE:h}=f.current;if("s1"===d)3!==S.length||h?(S.includes("s2")&&1===S.length||h)&&(f.current.INCORRECT_TRICEPS+=1,A(f.current.INCORRECT_TRICEPS)):(f.current.TRICEPS_COUNT+=1,I(f.current.TRICEPS_COUNT)),f.current.state_seq=[],f.current.INCORRECT_POSTURE=!1;else{const t=f.current;_>H.ANGLE_ELBOW.PASS[1]?t.DISPLAY_TEXT[0]=!0:_<H.ANGLE_ELBOW.NORMAL[0]&&1===t.state_seq.filter((e=>"s2"===e)).length&&(t.DISPLAY_TEXT[1]=!0),Math.abs(e.shoulder.x-e.elbow.x)>H.OFFSET_THRESH&&(t.DISPLAY_TEXT[2]=!0,t.INCORRECT_POSTURE=!0),Math.abs(e.wrist.y-e.elbow.y)<H.WRIST_THRESH&&(t.DISPLAY_TEXT[3]=!0,t.INCORRECT_POSTURE=!0)}i=!1,f.current.curr_state===f.current.prev_state?(T=Date.now(),f.current.INACTIVE_TIME+=T-f.current.start_inactive_time,f.current.start_inactive_time=T,f.INACTIVE_TIME>=H.INACTIVE_THRESH&&(i=!0)):(f.current.start_inactive_time=Date.now(),f.current.INACTIVE_TIME=0);const C=O.current?l-e.shoulder.x+10:e.shoulder.x+10,N=O.current?l-e.elbow.x+15:e.elbow.x+15,x=O.current?l-e.wrist.x+10:e.wrist.x+10;(f.current.state_seq.includes("s3")||"s1"===d)&&(f.current.INCORRECT_POSTURE=!1),f.current.DISPLAY_TEXT.forEach(((e,t)=>{e&&(f.current.COUNT_FRAMES[t]+=1)})),(e=>{const t=f.current;t.DISPLAY_TEXT.forEach(((t,r)=>{if(t){const t=p[r];t&&(0,a.m)(e,t.text,30,t.position,{textColor:t.textColor||"black",backgroundColor:t.backgroundColor||"yellow",fontSize:"16px"})}})),t.INCORRECT_POSTURE&&(0,a.m)(e,"CORRECT YOUR POSTURE",30,300,{textColor:"white",backgroundColor:"red",fontSize:"16px"})})(s),i&&(f.current.start_inactive_time=Date.now(),f.current.INACTIVE_TIME=0),(0,a.m)(s,` ${_.toFixed(2)}`,N,e.elbow.y+10,{textColor:a.Tj.light_green,fontSize:"16px"}),(0,a.m)(s,`${o.toFixed(2)}`,C,e.shoulder.y+10,{textColor:a.Tj.light_green,fontSize:"16px"}),(0,a.m)(s,`${R.toFixed(2)}`,x,e.wrist.y+10,{textColor:a.Tj.light_green,fontSize:"16px"}),(0,a.m)(s,`CORRECT: ${f.current.TRICEPS_COUNT}`,.68*l,30,{textColor:"rgb(255, 255, 230)",backgroundColor:"rgb(18, 185, 0)",fontSize:"14px"}),(0,a.m)(s,`INCORRECT: ${f.current.INCORRECT_TRICEPS}`,.68*l,80,{textColor:"rgb(255, 255, 230)",backgroundColor:"rgb(221, 0, 0)",fontSize:"14px"}),f.current.DISPLAY_TEXT.forEach(((e,t)=>{f.current.COUNT_FRAMES[t]>H.CNT_FRAME_THRESH&&(f.current.DISPLAY_TEXT[t]=!1,f.current.COUNT_FRAMES[t]=0)})),f.current.prev_state=d}}else{O.current&&(s.translate(o.width,0),s.scale(-1,1),s.drawImage(e.current.video,0,0,o.width,o.height),s.setTransform(1,0,0,1,0,0));const t=Date.now();f.current.INACTIVE_TIME+=t-f.current.start_inactive_time;let r=!1;f.current.INACTIVE_TIME>=H.INACTIVE_THRESH&&(r=!0),f.current.start_inactive_time=t,(0,a.m)(s,`CORRECT: ${f.current.TRICEPS_COUNT}`,.68*l,30,{textColor:"rgb(255, 255, 230)",backgroundColor:"rgb(18, 185, 0)",fontSize:"14px"}),(0,a.m)(s,`INCORRECT: ${f.current.INCORRECT_TRICEPS}`,.68*l,80,{textColor:"rgb(255, 255, 230)",backgroundColor:"rgb(221, 0, 0)",fontSize:"14px"}),r&&(f.current.start_inactive_time=Date.now(),f.current.INACTIVE_TIME=0),f.current.prev_state=null,f.current.curr_state=null,f.current.INACTIVE_TIME_FRONT=0,f.current.INCORRECT_POSTURE=!1,f.current.DISPLAY_TEXT=Array(5).fill(!1),f.current.start_inactive_time_front=Date.now()}}var n}),[]);return(0,n.useEffect)((()=>{const t=new l.Pose({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/pose/${e}`});return t.setOptions({modelComplexity:1,smoothLandmarks:!0,enableSegmentation:!1,smoothSegmentation:!1,minDetectionConfidence:.5,minTrackingConfidence:.5}),o.current=t,t.onResults(y),()=>{if(o.current&&(o.current.close(),o.current=null),r.current&&(r.current.stop(),r.current=null),e.current&&e.current.video&&e.current.video.srcObject){e.current.video.srcObject.getTracks().forEach((e=>e.stop())),e.current.video.srcObject=null}}}),[y]),(0,R.jsx)(R.Fragment,{children:(0,R.jsx)("div",{className:"card",children:(0,R.jsxs)("div",{className:"card-body",children:[(0,R.jsxs)("div",{className:"row",children:[(0,R.jsx)("div",{className:"col-md-6 col-sm-12 text-center mb-3",children:(0,R.jsx)("p",{children:"Video Alan\u0131"})}),(0,R.jsx)("div",{className:"col-md-6 col-sm-12 text-center mb-3",children:(0,R.jsx)("p",{children:"Bilgilendirme Alan\u0131"})})]}),(0,R.jsxs)("div",{className:"row",children:[(0,R.jsxs)("div",{className:"col-md-6 col-sm-12 mb-3",children:[(0,R.jsx)(s(),{ref:e,style:{display:"none"}}),(0,R.jsx)("canvas",{ref:t,className:"h-full w-full object-contain",style:{maxWidth:"100%",maxHeight:"100%",position:"relative",left:0,top:0}})]}),(0,R.jsxs)("div",{className:"col-md-6 col-sm-12",children:[(0,R.jsxs)("select",{className:"form-select","aria-label":"Default select example",onChange:e=>{const t="beginner"===e.target.value;C(t);const r=t?i.af:i.dT;m(r),console.log("Current Thresholds:",r)},value:h?"beginner":"pro",children:[(0,R.jsx)("option",{className:"dropdown-item",value:"beginner",children:"Beginner Mode"}),(0,R.jsx)("option",{className:"dropdown-item",value:"pro",children:"Pro Mode"})]}),(0,R.jsxs)("table",{className:"table mt-3",children:[(0,R.jsx)("thead",{children:(0,R.jsxs)("tr",{children:[(0,R.jsx)("th",{scope:"col",children:"Metric"}),(0,R.jsx)("th",{scope:"col",children:"Value"})]})}),(0,R.jsxs)("tbody",{children:[(0,R.jsxs)("tr",{children:[(0,R.jsx)("td",{children:"Correct"}),(0,R.jsx)("td",{children:N})]}),(0,R.jsxs)("tr",{children:[(0,R.jsx)("td",{children:"Incorrect"}),(0,R.jsx)("td",{children:x})]})]})]}),(0,R.jsx)("button",{className:"btn btn-success mt-3",onClick:()=>{g(!0),w()},children:"Start Sport"}),(0,R.jsx)("button",{className:"btn btn-danger mt-3 ms-2",onClick:()=>{if(0===N&&0===x||(async()=>{const e=null===S||void 0===S?void 0:S.id,t=(new Date).toISOString();try{const r=await(0,T.R7)({userId:e,exerciseId:5,correct:N,incorrect:x,createdDate:t});u.oR.success(`Kay\u0131t i\u015flemi ba\u015far\u0131yla tamamland\u0131! ${r}`)}catch(r){u.oR.error(`Sonu\xe7lar g\xf6nderilirken bir hata olu\u015ftu: ${r.message}`)}})(),I(0),A(0),f.current.LATERAL_RAISE_COUNT=0,f.current.IMPROPER_RAISE=0,o.current&&(o.current.close(),o.current=null),r.current&&(r.current.stop(),r.current=null),e.current&&e.current.video&&e.current.video.srcObject){e.current.video.srcObject.getTracks().forEach((e=>e.stop())),e.current.video.srcObject=null}if(g(!1),t.current){const e=t.current,r=e.getContext("2d");r.clearRect(0,0,e.width,e.height),r.fillStyle="black",r.fillRect(0,0,e.width,e.height)}d("/profile")},children:"Finish Sport"})]})]})]})})})}},82:(e,t,r)=>{r.d(t,{$H:()=>l,FS:()=>T,SK:()=>o,Tj:()=>E,gM:()=>a,hp:()=>i,m:()=>c});const n=(e,t,r)=>({x:e.x*t,y:e.y*r}),o=(e,t,r,o)=>{const s={nose:0,left:{shoulder:11,elbow:13,wrist:15,hip:23,knee:25,ankle:27,foot:31},right:{shoulder:12,elbow:14,wrist:16,hip:24,knee:26,ankle:28,foot:32}};if("nose"===t)return n(e[s.nose],r,o);if("left"===t||"right"===t){const l=s[t];return{shoulder:n(e[l.shoulder],r,o),elbow:n(e[l.elbow],r,o),wrist:n(e[l.wrist],r,o),hip:n(e[l.hip],r,o),knee:n(e[l.knee],r,o),ankle:n(e[l.ankle],r,o),foot:n(e[l.foot],r,o)}}throw new Error("Feature must be 'nose', 'left', or 'right'.")},s=e=>Math.sqrt(e.x*e.x+e.y*e.y),l=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0};const n={x:e.x-r.x,y:e.y-r.y},o={x:t.x-r.x,y:t.y-r.y},l=((c=n).x*(i=o).x+c.y*i.y)/(s(n)*s(o));var c,i;const a=Math.acos(Math.max(Math.min(l,1),-1));return Math.round(a*(180/Math.PI))},c=function(e,t,r,n){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};const{boxWidth:s=8,textColor:l="rgb(0, 255, 0)",backgroundColor:c="rgb(0, 0, 0)",fontSize:i="16px",fontFamily:a="Arial",paddingX:T=20,paddingY:E=10}=o;e.font=`${i} ${a}`;const u=e.measureText(t).width,_=parseInt(i,10);((e,t,r,n,o,s,l)=>{e.fillStyle=l,e.beginPath(),e.moveTo(t+s,r),e.arcTo(t+n,r,t+n,r+o,s),e.arcTo(t+n,r+o,t,r+o,s),e.arcTo(t,r+o,t,r,s),e.arcTo(t,r,t+n,r,s),e.closePath(),e.fill()})(e,r-T,n-_-E,u+2*T,_+2*E,s,c),e.fillStyle=l,e.fillText(t,r,n+E/2)},i=(e,t,r,n)=>{e.beginPath(),e.arc(t.x,t.y,r,0,2*Math.PI),e.fillStyle=n,e.fill()},a=(e,t,r,n,o)=>{e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(r.x,r.y),e.strokeStyle=n,e.lineWidth=o,e.stroke()},T=(e,t,r,n)=>{const o=Math.sqrt((r.x-t.x)**2+(r.y-t.y)**2),s=Math.floor(o/5);for(let l=0;l<s;l++){const o=t.x+(r.x-t.x)/s*l,c=t.y+(r.y-t.y)/s*l;e.beginPath(),e.arc(o,c,1,0,2*Math.PI),e.fillStyle=n,e.fill()}},E={blue:"rgb(0,127,255)",red:"rgb(255,50,50)",green:"rgb(0,255,127)",light_green:"rgb(100,233,127)",yellow:"rgb(255,255,0)",magenta:"rgb(255,0,255)",white:"rgb(255,255,255)",cyan:"rgb(0,255,255)",light_blue:"rgb(102,204,255)"}},155:(e,t,r)=>{r.d(t,{E2:()=>l,Jx:()=>c,PY:()=>o,QM:()=>T,_w:()=>s,af:()=>i,dT:()=>a,f_:()=>n,jK:()=>E});const n={ANGLE_ELBOW:{NORMAL:[0,20],TRANS:[21,70],PASS:[71,140]},ELBOW_THRESH:[10,140],INACTIVE_THRESH:10,CNT_FRAME_THRESH:30},o={ANGLE_HIP_KNEE_VERT:{NORMAL:[0,32],TRANS:[35,65],PASS:[70,95]},HIP_THRESH:[10,50],ANKLE_THRESH:45,KNEE_THRESH:[50,70,95],OFFSET_THRESH:35,INACTIVE_THRESH:15,CNT_FRAME_THRESH:50},s={ANGLE_HIP_KNEE_VERT:{NORMAL:[0,32],TRANS:[35,65],PASS:[80,95]},HIP_THRESH:[15,50],ANKLE_THRESH:30,KNEE_THRESH:[50,80,95],OFFSET_THRESH:35,INACTIVE_THRESH:15,CNT_FRAME_THRESH:50},l={ANGLE_SHOULDER_HIP_VERT:{NORMAL:[30,60],TRANS:[61,75],PASS:[76,90]},HIP_THRESH:[0,10],NECK_THRESH:[10,30],INACTIVE_THRESH:10,CNT_FRAME_THRESH:50},c={ANGLE_SHOULDER_HIP_VERT:{NORMAL:[35,55],TRANS:[56,70],PASS:[71,85]},HIP_THRESH:[0,5],NECK_THRESH:[5,20],INACTIVE_THRESH:8,CNT_FRAME_THRESH:50},i={ANGLE_ELBOW:{NORMAL:[0,5],TRANS:[6,15],PASS:[16,25]},OFFSET_THRESH:20,INACTIVE_THRESH:10,CNT_FRAME_THRESH:50},a={ANGLE_ELBOW:{NORMAL:[25,30],TRANS:[31,89],PASS:[90,120]},OFFSET_THRESH:20,INACTIVE_THRESH:10,CNT_FRAME_THRESH:50},T={ANGLE_SHOULDER:{NORMAL:[0,15],TRANS:[16,45],PASS:[46,90]},OFFSET_THRESH:20,INACTIVE_THRESH:10,CNT_FRAME_THRESH:50},E={ANGLE_SHOULDER:{NORMAL:[0,10],TRANS:[11,45],PASS:[46,90]},OFFSET_THRESH:20,INACTIVE_THRESH:10,CNT_FRAME_THRESH:50}}}]);
//# sourceMappingURL=28.670297be.chunk.js.map